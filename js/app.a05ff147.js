(function(t){function e(e){for(var r,s,l=e[0],c=e[1],i=e[2],h=0,d=[];h<l.length;h++)s=l[h],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);u&&u(e);while(d.length)d.shift()();return o.push.apply(o,i||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,l=1;l<n.length;l++){var c=n[l];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},a={app:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/v2map/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var i=0;i<l.length;i++)e(l[i]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"310b":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Info"),n("Map"),n("List",{attrs:{iniShow:!0,width:180,header:"btn panel"}},[n("InputGroup")],1),n("List",{attrs:{header:"Route : Points"}},t._l(t.getMarkers,(function(e,r){return n("div",{key:r,style:{background:e.selected?"tomato":"#555"},on:{click:function(n){return t.itemClick(e.latlng)}}},[n("div",{style:{padding:"10px",borderBottom:"2px solid #222"}},[n("div",[t._v("# marker "+t._s(r))]),n("div",{staticClass:"small"},[t._v("lat: "+t._s(e.latlng.lat)+" ")]),n("div",{staticClass:"small"},[t._v("lng: "+t._s(e.latlng.lng)+" ")])])])})),0),n("List",{attrs:{header:"table #1",width:600}},[n("Table",{attrs:{data:t.getMarkers,keys:["latlng","selected"]}})],1),n("List",{attrs:{header:"Routes / DEMO",width:600}},[n("Table",{attrs:{data:t.generateData,keys:["name","routePoints","nextRan"]}})],1),n("List",{attrs:{header:"Search Result / DEMO : hits: "+t.searchResult.length,width:600}},[n("Table",{attrs:{data:t.searchResult,keys:["name","routePoints","nextRan"]}})],1),n("List",{attrs:{header:"search"}},[n("h5",[t._v("route name:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.searchRouteName,expression:"searchRouteName"}],attrs:{type:"text",placeholder:"search by name..."},domProps:{value:t.searchRouteName},on:{input:function(e){e.target.composing||(t.searchRouteName=e.target.value)}}}),n("hr"),n("h5",[t._v("days to next pickup:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.searchDays,expression:"searchDays"}],ref:"dayToRanRange",attrs:{min:"0",max:"100",type:"range"},domProps:{value:t.searchDays},on:{__r:function(e){t.searchDays=e.target.value}}}),n("input",{attrs:{type:"text",readonly:""},domProps:{value:t.searchDays}}),n("button",{on:{click:t.runDemoSearch}},[t._v("go")])])],1)},o=[],s=(n("d81d"),n("cb29"),n("4de4"),n("4d63"),n("ac1f"),n("25f0"),n("466d"),n("b0c0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{height:"100vh",width:"100vw"}},[t.showMap?n("LMap",{ref:"mapel",staticStyle:{height:"100%"},attrs:{zoom:t.zoom,center:t.mapCenter,options:t.mapOptions},on:{"update:center":t.centerUpdate,"update:zoom":t.zoomUpdate,click:t.mapClicked}},[n("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t.showMarkers?n("div",t._l(t.getMarkers,(function(e,r){return n("LLayerGroup",{key:r},[n("LMarker",{attrs:{latLng:e.latlng,icon:e.selected?t.selectedIcon:t.icon,draggable:t.moveMarker},on:{click:function(e){return t.markerClick(r)},dragend:function(e){return t.updateMarker(e,r)}}})],1)})),1):t._e(),t.drawPath?n("div",[n("LLayerGroup",[n("LPolyline",{attrs:{latLngs:t.getMarkers.map((function(t){return t.latlng})),weight:4}})],1)],1):t._e(),t.drawPath?n("div",[n("LLayerGroup",[n("LPolyline",{attrs:{latLngs:t.customPath.filter((function(e){return t.markers[e]&&t.markers[e].latlng})).map((function(e){return t.markers[e].latlng})),weight:3,color:"red"}})],1)],1):t._e()],1):t._e()],1)}),l=[],c=n("2909"),i=(n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("a434"),n("99af"),n("e11e")),u=n("635f"),h=n("2699"),d=n("a40a"),f=n("4e2b"),g=n("1ebb"),p=n("2f62"),m=n("b85c"),v=(n("fb6a"),n("c740"),.25),k=5,b=100,y=1,M=0,_=10,O=20,w=function(t,e){return{lat:t,lng:e}},x=function(t,e,n){return{id:t,latlng:w(e,n),selected:!1}};function L(t,e){var n=6373,r=P(t.latlng.lat),a=P(t.latlng.lng),o=P(e.latlng.lat),s=P(e.latlng.lng),l=s-a,c=o-r,i=Math.pow(Math.sin(c/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin(l/2),2),u=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),h=n*u;return h}function P(t){return t*Math.PI/180}function j(t){for(var e=0,n=0;n<t.length-1;n++)e+=L(t[n],t[n+1]);return e}function S(t){var e=Object(c["a"])(t[0]);t.push(N(t[0]));for(var n=Array(t.length).fill(0),r=Object(c["a"])(t),a=new Set,o=[],s=0;s<b;s++){for(var l=[],i=0;i<r.length;i++)l.push({length:j(r[i]),indexInArray:i});l=l.sort((function(t,e){return t.length-e.length}));for(var u=[],h=0;h<(r.length-1<O?r.length-1:O);h++)u.push(r[l[h].indexInArray]);r=u;var d,f=I(JSON.parse(JSON.stringify(Object(c["a"])(r)))),g=[],p=Object(m["a"])(r);try{for(p.s();!(d=p.n()).done;){var _=d.value;g.push(j(_))}}catch(lt){p.e(lt)}finally{p.f()}for(var w=0,x=g[0],L=0;L<g.length;L++)x>g[L]&&(w=L,x=g[L]);var P=r[w];r=C(f);var S,A=Object(m["a"])(r);try{for(A.s();!(S=A.n()).done;){var E=S.value;D(E,e);var z=Math.random();if(z>v)for(var Y=0;Y<k;Y++)R(E)}}catch(lt){A.e(lt)}finally{A.f()}for(var T=0;T<r.length;T++){var X=JSON.stringify(r[T].map((function(t){return t.latlng})));a.has(X)||(a.add(X),o.push(T))}if(r.length>M){var $,G=[],J=Object(m["a"])(o);try{for(J.s();!($=J.n()).done;){var U=$.value;G.push(r[U])}}catch(lt){J.e(lt)}finally{J.f()}r=G}var W,q=[],B=Object(m["a"])(r);try{for(B.s();!(W=B.n()).done;){var Z=W.value;q.push(j(Z))}}catch(lt){B.e(lt)}finally{B.f()}var F=Math.min.apply(Math,q),H=[],K=F+F*y;if(r.length>M){for(var Q=0;Q<q.length;Q++)q[Q]<K&&H.push(Q);var V,tt=[],et=Object(m["a"])(H);try{for(et.s();!(V=et.n()).done;){var nt=V.value;tt.push(r[nt])}}catch(lt){et.e(lt)}finally{et.f()}r=tt}r.unshift(P),r.unshift(P),r.push(P)}for(var rt=0;rt<r.length;rt++)n[rt]=j(r[rt]);for(var at=0,ot=n[0],st=0;st<n.length;st++)ot>n[st]&&(at=st,ot=n[st]);return{route:r[at],length:ot}}function R(t){var e=Math.floor(Math.random()*t.length),n=Math.floor(Math.random()*t.length),r=t[e];t[e]=t[n],t[n]=r}function C(t){for(var e=[],n=0;n<t.start.length;n++)for(var r=0;r<t.end.length;r++)e.push([].concat(Object(c["a"])(t.start[n]),Object(c["a"])(t.end[r])));return e}function I(t){for(var e={start:[],end:[]},n=t[0].length,r=0,a=0;a<t.length;a++){if(r>_)break;var o=t[a].slice(0,n/2),s=t[a].slice(n/2,t[a].length);e.start.push(o),e.end.push(s),r++}return e}function N(t){var e=Object(c["a"])(t);return e.reverse(),e}function D(t,e){for(var n=Array(e.length).fill(0).map((function(t,e){return{index:e,count:0}})),r=0;r<n.length;r++)n[t[r].id].count++;for(var a=function(e){for(var r=0;r<n[e].count-1;r++){var a=t.findIndex((function(t){if(null!==t)return t.id===n[e].index}));t[a]=null}},o=0;o<n.length;o++)a(o);for(var s=0;s<n.length;s++)if(0===n[s].count)for(var l=0;l<t.length-1;l++){var c=t.findIndex((function(t){return null===t}));t[c]=JSON.parse(JSON.stringify(e[n[s].index]));break}}function A(t){for(var e=Object(c["a"])(t),n=[],r=[],a=0;a<t.length;a++)r.push(x(a,t[a].latlng.lat,t[a].latlng.lng,!1));return n.push(r),e=S(n),e}r["a"].use(p["a"]);var E=new p["a"].Store({state:{map:{center:Object(i["latLng"])(62.601017,29.763573),zoom:16},showPoints:!0,drawPath:!0,selectPath:!1,addMarker:!1,moveMarker:!1,test:0,routeLength:0,inter:null,markers:Array(10).fill(0).map((function(){return{latlng:Object(i["latLng"])(62.601017+Math.random()/6-.05,29.763573+Math.random()/3-.05),selected:!1}})),customPath:[]},mutations:{test:function(){console.log(E)},setCenter:function(t,e){t.map.center=e},computeSome:function(t){var e=A(t.markers);t.markers=e.route,t.length=e.length}},getters:{moveMarker:function(t){return t.moveMarker}}}),z=E,Y=(n("6cc5"),new Set);window.addEventListener("keydown",(function(t){Y.add(t.key)})),window.addEventListener("keyup",(function(t){Y.delete(t.key)}));var T={components:{LPolyline:u["a"],LMap:h["a"],LTileLayer:d["a"],LMarker:f["a"],LLayerGroup:g["a"]},mounted:function(){this.markers=z.state.markers},data:function(){return{zoom:11,center:Object(i["latLng"])(62.601017,29.763573),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:13,currentCenter:Object(i["latLng"])(62.601017,29.763573),showParagraph:!1,mapOptions:{zoomSnap:.5},customPath:[],markers:[],selectedIndex:null,selectedIcon:Object(i["icon"])({iconUrl:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-512.png",iconSize:[64,74],iconAnchor:[32,74]}),icon:Object(i["icon"])({iconUrl:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-512.png",iconSize:[32,37],iconAnchor:[16,37]}),showMap:!0}},computed:{getMarkers:{get:function(){return z.state.markers},set:function(t){return t}},showMarkers:function(){return z.state.showPoints},drawPath:function(){return z.state.drawPath},selectPath:function(){return z.state.selectPath},addMarker:function(){return z.state.addMarker},moveMarker:function(){return z.state.moveMarker},mapCenter:function(){return z.state.map.center}},methods:{zoomUpdate:function(t){this.zoom=t},centerUpdate:function(t){this.currentCenter=t,this.center=t,z.commit("setCenter",t)},showLongText:function(){this.showParagraph=!this.showParagraph},gorandom:function(){this.centerUpdate(Object(i["latLng"])(47.41322,-1.219482))},mapClicked:function(t){if(console.log(this.selectedIndex),this.addMarker){if(null!==this.selectedIndex){console.log("put here ",this.selectedIndex);var e=Object(c["a"])(this.getMarkers),n=e.splice(this.selectedIndex+1),r=[].concat(Object(c["a"])(e),[{latlng:t.latlng,selected:!1}],Object(c["a"])(n));return this.markers=r,z.state.markers=r,this.getMarkers[this.selectedIndex].selected=!1,void(this.selectedIndex=null)}z.state.markers=[].concat(Object(c["a"])(this.getMarkers),[{latlng:t.latlng,selected:!1}])}},updateMarker:function(t,e){var n=this.getMarkers;n[e].latlng=t.target._latlng,this.getMarkers=n},markerClick:function(t){var e=this.getMarkers;if(this.selectPath&&(this.customPath=[].concat(Object(c["a"])(this.customPath),[t]),z.state.customPath=this.customPath),Y.has("Shift")){if(null!==this.selectedIndex){var n=this.getMarkers,r=this.getMarkers[t];n[this.selectedIndex].selected=!1,n[t]=n[this.selectedIndex],n[this.selectedIndex]=r,this.getMarkers=n,this.selectedIndex=null}}else{if(Y.has("Control")){var a=this.getMarkers;return a.splice(t,1),void(this.getMarkers=a)}if(null!==this.selectedIndex&&(e[this.selectedIndex].selected=!1),this.selectedIndex===t)return e[this.selectedIndex].selected=!1,this.getMarkers=e,void(this.selectedIndex=null);e[t].selected=!0,this.selectedIndex=t,this.getMarkers=e}}}},X=T,$=n("2877"),G=Object($["a"])(X,s,l,!1,null,null,null),J=G.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"info-panel"},[t._v(" lat: "+t._s(t.mapCenter.lat)+" "),n("br"),t._v(" lng: "+t._s(t.mapCenter.lng)+" ")])},W=[],q={data:function(){return{}},computed:{mapCenter:{get:function(){return z.state.map.center}}}},B=q,Z=(n("e385"),Object($["a"])(B,U,W,!1,null,"c314db64",null)),F=Z.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("LMarker")},K=[],Q={components:{LMarker:f["a"]},beforeMount:function(){console.log("marker mounted")}},V=Q,tt=Object($["a"])(V,H,K,!1,null,null,null),et=(tt.exports,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container2"},[n("button",{style:{background:t.showMarkers?t.ALLOW_COLOR:t.DENY_COLOR},on:{click:t.toggleMarkers}},[t._v(" show markers: "),n("b",[t._v(t._s(t.showMarkers))])]),n("button",{style:{background:t.showPath?t.ALLOW_COLOR:t.DENY_COLOR},on:{click:t.togglePath}},[t._v(" show markers: "),n("b",[t._v(t._s(t.showPath))])]),n("button",{style:{background:t.selectPath?t.ALLOW_COLOR:t.DENY_COLOR},on:{click:t.toggleSelectPath}},[t._v(" select path: "),n("b",[t._v(t._s(t.selectPath))])]),n("button",{style:{background:t.addMarker?t.ALLOW_COLOR:t.DENY_COLOR},on:{click:t.toggleAddMarker}},[t._v(" add marker: "),n("b",[t._v(t._s(t.addMarker))])]),n("button",{style:{background:t.moveMarker?t.ALLOW_COLOR:t.DENY_COLOR},on:{click:t.toggleMoveMarker}},[t._v(" move marker: "),n("b",[t._v(t._s(t.moveMarker))])]),n("button",{on:{click:t.computeSome}},[t._v(" compute ")])])}),nt=[],rt={components:{},data:function(){return{ALLOW_COLOR:"#4CD261",DENY_COLOR:"#F73830"}},computed:{showMarkers:{get:function(){return z.state.showPoints}},showPath:{get:function(){return z.state.drawPath}},selectPath:{get:function(){return z.state.selectPath}},addMarker:{get:function(){return z.state.addMarker}},moveMarker:{get:function(){return z.state.moveMarker}}},methods:{computeSome:function(){z.commit("computeSome")},testClick:function(){console.log("toggle test")},toggleMarkers:function(){z.state.showPoints=!z.state.showPoints},togglePath:function(){z.state.drawPath=!z.state.drawPath},toggleSelectPath:function(){z.state.selectPath=!z.state.selectPath},toggleAddMarker:function(){z.state.addMarker=!z.state.addMarker},toggleMoveMarker:function(){z.state.moveMarker=!z.state.moveMarker}}},at=rt,ot=(n("868d"),Object($["a"])(at,et,nt,!1,null,"c7703b76",null)),st=ot.exports,lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",style:{left:t.x+"px",top:t.y+"px",width:t.width+"px"}},[n("div",{staticClass:"drag-zone",attrs:{draggable:"true"},on:{dragend:t.updateXY,dragstart:t.calcStart,mousedown:t.cleanSelect}},[t._v(" DRAG ZONE ")]),n("h4",{staticStyle:{"padding-bottom":"10px","font-size":"20px"}},[t._v(t._s(t.header))]),t.show?n("div",{style:{maxHeight:"300px",overflow:"auto"}},[t._t("default")],2):t._e(),n("hr"),n("div",[n("button",{on:{click:t.toggle}},[n("span",[t._v(t._s(t.show?"close":"open"))])])])])},ct=[],it=(n("a9e3"),{props:{header:{type:String,default:"header"},width:{type:Number,default:300},iniShow:{type:Boolean,default:!1}},data:function(){return{startX:0,startY:0,x:100,y:100,show:!0}},mounted:function(){this.show=this.iniShow},computed:{getLength:function(){return z.state.routeLength}},methods:{toggle:function(){this.show=!this.show},calcStart:function(t){this.startX=t.clientX-this.x,this.startY=t.clientY-this.y,console.log("start : ",this.startX,this.startY)},updateXY:function(t){this.x=t.clientX-this.startX,this.y=t.clientY-this.startY},cleanSelect:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}}}),ut=it,ht=(n("a121"),Object($["a"])(ut,lt,ct,!1,null,"9da1e5b8",null)),dt=ht.exports,ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",[n("thead",[n("tr",{staticStyle:{background:"#222"}},t._l(t.keys,(function(e,r){return n("th",{key:r},[t._v(" "+t._s(e)+" ")])})),0)]),n("tbody",t._l(t.data,(function(e,r){return n("tr",{key:r,style:{background:r%2===0?"#333":"#444"}},t._l(t.keys,(function(r,a){return n("td",{key:a},[t._v(" "+t._s(e[r])+" ")])})),0)})),0)])},gt=[],pt={props:{data:{type:Array},keys:{type:Array}},data:function(){return{}},mounted:function(){}},mt=pt,vt=(n("feec"),Object($["a"])(mt,ft,gt,!1,null,"0e93c923",null)),kt=vt.exports,bt={components:{List:dt,Map:J,Info:F,InputGroup:st,Table:kt},data:function(){return{searchRouteName:"",searchResult:[],searchDays:30}},computed:{getMarkers:function(){return console.log(z.state.markers),z.state.markers},generateData:{get:function(){var t=["biojäte","raskasmetalli","huonekalujen","testipaja","roskalava","ruoka","lääke","aspfaltti","rengaskauppa","s-marker","pahvi","ajelu","kierros","kaikki käy"],e=["keräys","tyhjennys","huolto","korjaus","reitti","yöreitti","päiväreitti","kerran vuodessa","kerran viikossa","kerran päivässä"],n=Array(1e3).fill(0).map((function(){return{name:t[Math.floor(Math.random()*t.length)]+" "+e[Math.floor(Math.random()*e.length)],nextRan:Math.floor(100*Math.random()+1),routePoints:Math.floor(10*Math.random()+5)}}));return n}}},methods:{itemClick:function(t){console.log(t.lat),z.state.map.center=t},runDemoSearch:function(){var t=parseInt(this.$refs.dayToRanRange.value),e=this.generateData.filter((function(e){return e.nextRan<=t}));if(""!==this.searchRouteName){var n=new RegExp(this.searchRouteName,"g");e=e.filter((function(t){return t.name.match(n)}))}e=e.sort((function(t,e){return t.nextRan-e.nextRan})),this.searchResult=e}}},yt=bt,Mt=(n("034f"),Object($["a"])(yt,a,o,!1,null,null,null)),_t=Mt.exports;r["a"].config.productionTip=!1,new r["a"]({el:"#app",store:z,render:function(t){return t(_t)}})},"72b3":function(t,e,n){},"85ec":function(t,e,n){},"868d":function(t,e,n){"use strict";n("310b")},"894c":function(t,e,n){},a121:function(t,e,n){"use strict";n("d407")},d407:function(t,e,n){},e385:function(t,e,n){"use strict";n("894c")},feec:function(t,e,n){"use strict";n("72b3")}});
//# sourceMappingURL=app.a05ff147.js.map